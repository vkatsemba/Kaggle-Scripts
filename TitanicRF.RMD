---
title: "Classifying Titanic Passengers as Survivors or Victims"
output: html_notebook
---
We will explore the Titanic dataset and build a model that will predict whether or not a passenger survived or not.

```{r message=FALSE, warning=FALSE}
library(dplyr)         
library(ggplot2)
library(rpart)
library(rpart.plot)
library(caret)
library(randomForest)
```


```{r}
train <- read.csv("C:\\Users\\Vadim_Katsemba\\Downloads\\Titanictrain.csv")
test <- read.csv("C:\\Users\\Vadim_Katsemba\\Downloads\\Titanictest.csv")
```

```{r}
test$Survived <- NA
all_data <- rbind(train, test)
```

```{r}
ggplot(all_data[1:891,], aes(Age, fill = factor(Survived))) + geom_histogram(bins = 30) + xlab("Age") + scale_fill_discrete(name = "Survived") + ggtitle("Survivors by Age")
```

```{r}
age_pred <- rpart(Age ~ Pclass + Sex + SibSp + Parch + Fare + Embarked + Title + FamilySize, data = all_data[!is.na(all_data$Age),], method = "anova")
all_data$Age[is.na(all_data$Age)] <- predict(age_pred, all_data[is.na(all_data$Age),])
```


```{r}
ggplot(all_data[1:891,], aes(Sex, fill = factor(Survived))) + geom_bar(stat = "count", position = "dodge") + xlab("Sex") + scale_fill_discrete(name = "Survived") + ggtitle("Survivors by Sex")
```

```{r}
ggplot(all_data[1:891,], aes(Age, fill = factor(Survived))) + geom_histogram(bins = 30) + xlab("Age") + facet_grid(.~Sex) + scale_fill_discrete(name = "Survived") + ggtitle("Survivors by Age and Sex")
```

```{r}
ggplot(all_data[1:891,], aes(Pclass, fill = factor(Survived))) + geom_bar(stat = "count") + xlab("Pclass") + facet_grid(.~Sex) + scale_fill_discrete(name = "Survived") + ggtitle("Survivors by Passenger Class and Sex")
```

```{r}
ggplot(all_data[1:891,], aes(x = Age, y = Sex)) +
  geom_jitter(aes(colour = factor(Survived))) +
  facet_wrap(~Pclass) +
  labs(x = "Age", y = "Sex", title = "Survivors by Age, Sex and Passenger Class") +
  scale_fill_discrete(name = "Survived") +
  scale_x_continuous(name = "Age", limits = c(0, 81))
```

```{r}
all_data$Embarked[c(62, 830)] <- "S"
all_data$Embarked <- factor(all_data$Embarked)

all_data$Fare[1044] <- median(all_data$Fare, na.rm = TRUE)
```


```{r}
all_data$Title <- gsub('(.*, )|(\\..*)', '', all_data$Name)
table(all_data$Sex, all_data$Title)
```

```{r}
officer <- c('Capt', 'Col', 'Don', 'Dr', 'Major', 'Rev')
royalty <- c('Dona', 'Lady', 'the Countess','Sir', 'Jonkheer')

all_data$Title[all_data$Title == 'Mlle']        <- 'Miss' 
all_data$Title[all_data$Title == 'Ms']          <- 'Miss'
all_data$Title[all_data$Title == 'Mme']         <- 'Mrs' 
all_data$Title[all_data$Title %in% royalty]  <- 'Royalty'
all_data$Title[all_data$Title %in% officer]  <- 'Officer'
```

```{r}
ggplot(all_data[1:891,], aes(Title,fill = factor(Survived))) +
  geom_bar(stat = "count")+
  xlab('Title') +
  scale_fill_discrete(name = " Survived") + 
  ggtitle("Survivors by Title")
```

```{r}
all_data$FamilySize <- all_data$SibSp + all_data$Parch + 1

ggplot(all_data[1:891,], aes(x = FamilySize, fill = factor(Survived))) +
  geom_bar(stat='count', position='dodge') +
  scale_x_continuous(breaks=c(1:11)) +
  xlab('Family Size') +
  scale_fill_discrete(name = "Survived") + 
  ggtitle("Survivors by Family Size")
```


```{r}
train <- all_data[1:891,]
test <- all_data[892:1309,]
```

```{r}
set.seed(1234)
rf_model1 <- randomForest(as.factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked, data=train, importance=TRUE,ntree=1000)
```

